// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu
{
	"name": "Vscode Sandbox",
	// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
	"build": {
    "dockerfile": "Dockerfile"
  },
  "runArgs": ["--env-file", ".devcontainer/devcontainer.env"],
  // Features to add to the dev container. More info: https://containers.dev/features.
  "features": {
    "ghcr.io/devcontainers/features/docker-in-docker:2.12.4": {}
  },

	// Use 'forwardPorts' to make a list of ports inside the container available locally.
	// "forwardPorts": [],

	// Use 'postCreateCommand' to run commands after the container is created.
	// "postCreateCommand": "uname -a",

	// Configure tool-specific properties.
"customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.vscode-json",
        "redhat.vscode-yaml",
				"GitHub.copilot",
				"GitHub.copilot-chat",
        "ms-vscode.vscode-eslint",
        "esbenp.prettier-vscode",
        "HashiCorp.HCL",
        "hashicorp.terraform"
      ],
      "mcp": {
        "servers": {
          // "github-mcp": {
          //   "type": "http",
          //   "url": "https://api.githubcopilot.com/mcp/"
          // },
          // "terraform": {
          //   "type": "stdio",
          //   "command": "/usr/local/bin/terraform-mcp-server"
          // }
          "terraform": {
            "command": "docker",
            "args": [
              "run",
              "-i",
              "--rm",
              "-e",
              "TFE_TOKEN",
              "hashicorp/terraform-mcp-server"
            ]
          },
          "aws-knowledge-mcp-server": {
            "url": "https://knowledge-mcp.global.api.aws",
            "type": "http"
          }
        }
      }
		}
	},
	// Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
	// "remoteUser": "root"
  "remoteEnv": {
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}",
    "TFE_TOKEN": "${localEnv:TEAM_TFE_TOKEN}",
    "TF_TOKEN_app_terraform_io": "${localEnv:TEAM_TFE_TOKEN}",
    "AWS_ACCESS_KEY_ID": "${localEnv:AWS_ACCESS_KEY_ID}",
    "AWS_SECRET_ACCESS_KEY": "${localEnv:AWS_SECRET_ACCESS_KEY}",
    "AWS_SESSION_TOKEN": "${localEnv:AWS_SESSION_TOKEN}",
    "AWS_SESSION_EXPIRATION": "${localEnv:AWS_SESSION_EXPIRATION}",
    "VAULT_RADAR_LICENSE": "${localEnv:VAULT_RADAR_LICENSE:}"
  },
  "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=delegated",
  "workspaceFolder": "/workspace"
}
